var express = require("express");
var router = express.Router();
const os = require("os");
const { checkBody } = require("../modules/checkbody");

const fs = require("fs");
const path = require("path");
const { authenticateToken } = require("../modules/token");

// Route to read and return the syslog file
router.get("/combined", authenticateToken, async (req, res) => {
  console.log("- in GET /list-apps");
  const syslogPath = process.env.FILE_PATH_SYSLOG;
  const pm2CombinedOutput = process.env.FILE_PATH_PM2_OUTPUT;
  const pm2CombinedError = process.env.FILE_PATH_PM2_ERROR;

  const responseBody = {};
  try {
    const dataSyslog = await fs.promises.readFile(syslogPath, "utf8");
    responseBody["syslog"] = dataSyslog;
    // console.log("----> read syslog and added");
  } catch (error) {
    console.error("Error reading syslog:", error);
    responseBody["syslog"] = false;
  }
  try {
    const dataPm2CombinedOutput = await fs.promises.readFile(
      pm2CombinedOutput,
      "utf8"
    );
    responseBody["pm2CombinedOutput"] = dataPm2CombinedOutput;
    // console.log("----> read pm2CombinedOutput and added");
  } catch (error) {
    responseBody["pm2CombinedOutput"] = false;
    console.error("Error reading pm2CombinedOutput:", error);
  }
  try {
    const dataPm2CombinedError = await fs.promises.readFile(
      pm2CombinedError,
      "utf8"
    );
    responseBody["pm2CombinedError"] = dataPm2CombinedError;
    // console.log("----> read dataPm2CombinedError and added");
  } catch (error) {
    responseBody["dataPm2CombinedError"] = false;
    console.error("Error reading pm2CombinedError:", error);
  }
  return res.json({ responseBody });
});

module.exports = router;

const fauxDonnes = {
  result: true,
  syslog:
    'Nov 25 00:00:01 developmentserver systemd[1]: logrotate.service: Succeeded.\nNov 25 00:00:01 developmentserver systemd[1]: Finished Rotate log files.\nNov 25 00:00:01 developmentserver systemd[1]: man-db.service: Succeeded.\nNov 25 00:00:01 developmentserver systemd[1]: Finished Daily man-db regeneration.\nNov 25 00:00:02 developmentserver fstrim[10481]: /: 29.1 GiB (31280050176 bytes) trimmed on /dev/disk/by-uuid/b5468d24-256b-4f07-be07-572675bfa57a\nNov 25 00:00:02 developmentserver systemd[1]: fstrim.service: Succeeded.\nNov 25 00:00:02 developmentserver systemd[1]: Finished Discard unused blocks on filesystems from /etc/fstab.\nNov 25 00:15:32 developmentserver systemd[1]: fwupd.service: Succeeded.\nNov 25 00:17:01 developmentserver CRON[10530]: (root) CMD (   cd / && run-parts --report /etc/cron.hourly)\nNov 25 00:35:01 developmentserver CRON[10539]: (root) CMD (   test -x /etc/cron.daily/popularity-contest && /etc/cron.daily/popularity-contest --crond)\nNov 25 01:17:01 developmentserver CRON[10551]: (root) CMD (   cd / && run-parts --report /etc/cron.hourly)\nNov 25 02:17:01 developmentserver CRON[10568]: (root) CMD (   cd / && run-parts --report /etc/cron.hourly)\nNov 25 02:44:31 developmentserver snapd[850]: storehelpers.go:923: cannot refresh: snap has no updates available: "core20", "lxd", "snapd"\nNov 25 03:10:01 developmentserver CRON[10585]: (root) CMD (test -e /run/systemd/system || SERVICE_MODE=1 /sbin/e2scrub_all -A -r)\nNov 25 03:16:48 developmentserver systemd[1]: Starting Ubuntu Advantage Timer for running repeated jobs...\nNov 25 03:16:49 developmentserver systemd[1]: ua-timer.service: Succeeded.\nNov 25 03:16:49 developmentserver systemd[1]: Finished Ubuntu Advantage Timer for running repeated jobs.\nNov 25 03:17:01 developmentserver CRON[10613]: (root) CMD (   cd / && run-parts --report /etc/cron.hourly)\nNov 25 04:17:01 developmentserver CRON[10630]: (root) CMD (   cd / && run-parts --report /etc/cron.hourly)\nNov 25 05:10:05 developmentserver systemd[1]: Starting Daily apt download activities...\nNov 25 05:10:06 developmentserver systemd[1]: Starting Update APT News...\nNov 25 05:10:06 developmentserver systemd[1]: Starting Update the local ESM caches...\nNov 25 05:10:07 developmentserver dbus-daemon[835]: [system] Activating via systemd: service name=\'org.freedesktop.PackageKit\' unit=\'packagekit.service\' requested by \':1.62\' (uid=0 pid=11054 comm="/usr/bin/gdbus call --system --dest org.freedeskto" label="unconfined")\nNov 25 05:10:07 developmentserver systemd[1]: Starting PackageKit Daemon...\nNov 25 05:10:07 developmentserver PackageKit: daemon start\nNov 25 05:10:07 developmentserver dbus-daemon[835]: [system] Successfully activated service \'org.freedesktop.PackageKit\'\nNov 25 05:10:07 developmentserver systemd[1]: Started PackageKit Daemon.\nNov 25 05:10:07 developmentserver systemd[1]: esm-cache.service: Succeeded.\nNov 25 05:10:07 developmentserver systemd[1]: Finished Update the local ESM caches.\nNov 25 05:10:08 developmentserver systemd[1]: apt-news.service: Succeeded.\nNov 25 05:10:08 developmentserver systemd[1]: Finished Update APT News.\nNov 25 05:10:16 developmentserver systemd[1]: apt-daily.service: Succeeded.\nNov 25 05:10:16 developmentserver systemd[1]: Finished Daily apt download activities.\nNov 25 05:15:12 developmentserver PackageKit: daemon quit\nNov 25 05:15:12 developmentserver systemd[1]: packagekit.service: Succeeded.\nNov 25 05:17:01 developmentserver CRON[11229]: (root) CMD (   cd / && run-parts --report /etc/cron.hourly)\nNov 25 06:02:01 developmentserver systemd[1]: Starting Daily apt upgrade and clean activities...\nNov 25 06:02:20 developmentserver systemd[1]: apt-daily-upgrade.service: Succeeded.\nNov 25 06:02:20 developmentserver systemd[1]: Finished Daily apt upgrade and clean activities.\nNov 25 06:17:01 developmentserver CRON[11344]: (root) CMD (   cd / && run-parts --report /etc/cron.hourly)\nNov 25 06:25:01 developmentserver CRON[11350]: (root) CMD (test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily ))\nNov 25 06:59:31 developmentserver systemd[1]: Starting Message of the Day...\nNov 25 06:59:39 developmentserver 50-motd-news[11466]:  * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s\nNov 25 06:59:39 developmentserver 50-motd-news[11466]:    just raised the bar for easy, resilient and secure K8s cluster deployment.\nNov 25 06:59:39 developmentserver 50-motd-news[11466]:    https://ubuntu.com/engage/secure-kubernetes-at-the-edge\nNov 25 06:59:39 developmentserver systemd[1]: motd-news.service: Succeeded.\nNov 25 06:59:39 developmentserver systemd[1]: Finished Message of the Day.\nNov 25 07:17:01 developmentserver CRON[11495]: (root) CMD (   cd / && run-parts --report /etc/cron.hourly)\nNov 25 08:17:01 developmentserver CRON[11526]: (root) CMD (   cd / && run-parts --report /etc/cron.hourly)\nNov 25 09:17:01 developmentserver CRON[11540]: (root) CMD (   cd / && run-parts --report /etc/cron.hourly)\nNov 25 09:48:25 developmentserver systemd[1]: Starting Ubuntu Advantage Timer for running repeated jobs...\nNov 25 09:48:26 developmentserver systemd[1]: ua-timer.service: Succeeded.\nNov 25 09:48:26 developmentserver systemd[1]: Finished Ubuntu Advantage Timer for running repeated jobs.\nNov 25 09:49:31 developmentserver snapd[850]: storehelpers.go:923: cannot refresh: snap has no updates available: "core20", "lxd", "snapd"\nNov 25 10:17:01 developmentserver CRON[11583]: (root) CMD (   cd / && run-parts --report /etc/cron.hourly)\nNov 25 11:17:01 developmentserver CRON[11600]: (root) CMD (   cd / && run-parts --report /etc/cron.hourly)\nNov 25 12:14:31 developmentserver systemd[1]: Starting Cleanup of Temporary Directories...\nNov 25 12:14:31 developmentserver systemd[1]: systemd-tmpfiles-clean.service: Succeeded.\nNov 25 12:14:31 developmentserver systemd[1]: Finished Cleanup of Temporary Directories.\nNov 25 12:17:01 developmentserver CRON[11636]: (root) CMD (   cd / && run-parts --report /etc/cron.hourly)\nNov 25 12:37:55 developmentserver systemd[1]: Started Session 74 of user dashanddata_user.\nNov 25 12:39:31 developmentserver snapd[850]: storehelpers.go:923: cannot refresh: snap has no updates available: "core20", "lxd", "snapd"\nNov 25 13:17:01 developmentserver CRON[12097]: (root) CMD (   cd / && run-parts --report /etc/cron.hourly)\nNov 25 13:35:31 developmentserver systemd[1]: session-74.scope: Succeeded.\nNov 25 13:45:47 developmentserver systemd[1]: Starting Refresh fwupd metadata and update motd...\nNov 25 13:45:47 developmentserver dbus-daemon[835]: [system] Activating via systemd: service name=\'org.freedesktop.fwupd\' unit=\'fwupd.service\' requested by \':1.69\' (uid=111 pid=12182 comm="/usr/bin/fwupdmgr refresh " label="unconfined")\nNov 25 13:45:47 developmentserver systemd[1]: Starting Firmware update daemon...\nNov 25 13:45:48 developmentserver dbus-daemon[835]: [system] Successfully activated service \'org.freedesktop.fwupd\'\nNov 25 13:45:48 developmentserver systemd[1]: Started Firmware update daemon.\nNov 25 13:45:48 developmentserver fwupdmgr[12182]: Updating lvfs\nNov 25 13:45:48 developmentserver fwupdmgr[12182]: Downloading…: 0%\nNov 25 13:45:48 developmentserver fwupdmgr[12182]: Downloading…: 100%\nNov 25 13:45:48 developmentserver fwupdmgr[12182]: Idle…: 100%\nNov 25 13:45:48 developmentserver fwupdmgr[12182]: Downloading…: 100%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 0%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 1%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 2%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 3%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 4%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 6%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 8%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 9%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 11%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 12%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 14%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 16%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 17%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 19%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 21%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 22%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 24%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 25%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 27%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 29%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 30%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 32%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 33%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 35%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 37%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 38%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 40%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 42%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 43%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 45%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 46%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 48%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 50%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 51%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 53%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 54%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 56%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 58%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 59%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 61%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 63%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 64%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 66%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 67%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 69%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 71%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 72%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 74%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 76%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 77%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 79%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 80%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 82%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 84%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 85%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 87%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 88%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 90%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 92%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 93%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 95%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 97%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 98%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Downloading…: 100%\nNov 25 13:45:49 developmentserver fwupdmgr[12182]: Idle…: 100%\nNov 25 13:45:50 developmentserver fwupdmgr[12182]: Successfully downloaded new metadata: 0 local devices supported\nNov 25 13:45:50 developmentserver systemd[1]: fwupd-refresh.service: Succeeded.\nNov 25 13:45:50 developmentserver systemd[1]: Finished Refresh fwupd metadata and update motd.\nNov 25 14:17:01 developmentserver CRON[12251]: (root) CMD (   cd / && run-parts --report /etc/cron.hourly)\nNov 25 14:43:13 developmentserver systemd[1]: Started Session 77 of user dashanddata_user.\nNov 25 14:51:50 developmentserver systemd[1]: Started Session 78 of user dashanddata_user.\n',
};
